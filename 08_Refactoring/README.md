
# 概要
挙動を変えずに可読性を高めること。
一度に考えることを減らすこと。
名前を変える、不要なものを削除する、必要なものを追加する、まとめる、分割する、作りを統一するetc...

過剰とも呼べる(しかし表面的に過ぎない)リファクタリングは可読性に寄与しないので注意する。

基本的にリファクタリングの重要度が上がる箇所ほど難易度が上がる。
最も重要なのはビジネスレベルのリファクタリングになるがここでは述べない。


# リファクタリングのメリット

- ソフトウェアの設計を向上させる。
- ソフトウェアの劣化を緩やかにする。
- メンテナンス性を上げる。
- 開発が破綻なく継続して開発できる可能性が上がる(リファクタリングが行われない場合はどこかで必ず破綻する)


# リファクタリングすることのデメリット

- 進捗が重要なフェーズでリファクタリングを延々と続けるケースがそれなりの割合で有る。
- 最初の実装及び軽微な修正などその瞬間においてはリファクタリングしないほうが実装・改修が早くなる可能性がある。
- 評価されにくい。モックアップや一次開発をメンテナンス性が考慮されていない+すぐに顕在化されない不具合を放置して高速に実装。その実績を引っさげて転職、改修する人間が地獄を見るというケースも有り得る。
- その他業務形態が影響する場合もある。例えばSESや派遣など時間によって売上が上がるタイプの仕事はよりめんどくさくしたほうが売上が立つ。
- プロジェクトが破綻しても発注先(実装者)にほぼ影響がないとなれば、後は実装者の理念とかポリシーだとかの問題になってしまう。

効率 = 悪 な業界においてはリファクタリングすることがデメリットになるかもしれない。


# いつリファクタリングするか

一般的に3回同じことをしていたらリファクタリングをおこなう。
機能追加、バグ修正など既存の状態から変更を加えるときにもリファクタリングをおこなえる。
可能ならリファクタリング専用の作業期間を設けてもいい。

# 何をリファクタリングするか

不吉な匂い(臭い)と呼ばれる箇所。
http://objectclub.jp/technicaldoc/refactoring/refact-smell

## 重複したコード

似たようなコードは一箇所にまとめる。

ただしそれが本当に重複しているのかは意識する必要がある。

たまたまコードに変換したとき似ただけで本質的に違うものなら共通化するべきではない。

## 長すぎるメソッド、巨大なクラス、その他多すぎるXXXX

大抵複数の処理をしている。分割する。

ただし業務上の一連の処理がそもそも複雑でコードに変換すると長いというケースもある。

その場合分割するかは検討が必要。分割したところで読みやすくならない、却って読みにくくなるということもありうる。

## 仕様変更に弱すぎる構造
1機能変更するのに複数箇所変更しないといけないといったことが何度も起きるとき改善する。

理想は変更とクラスが1体1になるようにする。
難しい。

## データの群れ

クラスのメンバやメソッドの引数など複数箇所で同じようなパラメータ群を使用している場合、
クラスなどやそれに類する言語機能を使用してデータ構造をまとめる。

## 無意味(有害)なコード群


機能が極端に少ない怠け者クラス、直近で使用予定のない凝った仕組み、過剰な仲介メソッド、フルオープン＆アクセス過剰なデータクラスなど。


※ まだあるが上記以外は複雑だったり言語的な問題だったりするので省略


# どうやってリファクタリングするか

## 名前をつける、名前を変える
説明用の変数を用意する。
曖昧な表現をより正確な名前に変更する。

ユーザデータを取得する
getData
↓
fetchUser


方針としては一箇所なら説明変数（ローカル変数おそらく近いほうがいい）、複数（三箇所が目安）出てきたら定数、関数化。

特別な意味合いを持たせるならクラス化することも考える。


## 不要なものを削除する
変数、引数、果ては関数やクラスそのものなど。

対象の使用頻度によって例えば引数だったらデフォルト引数にしたり、場合によっては分割することも考える。

``` ts

function func(name: string, unusedArg: string) {

  const a = 0
  console.log(`Hello Refactring ${name}!!`)

}

```

↓

``` ts

function func(name: string) {

  console.log(`Hello Refactring ${name}!!`)

}

```



## 必要なものをあるべき場所に配置する

クラス内部で保持しているパラメータを引数で受け取るようにする。

引き回しているメソッドの引数など内部で持つ。

専用に引数オブジェクトを作成する。


## 分割する

複雑な処理を意味のある単位にまとめる。
機能単位で分割し繰り返しをくくりだす。

## まとめる

過剰に分割されたもはや単体で意味を持たない処理をまとめる。
分割不可能な複雑な業務ロジックを無理に分割しているケースなど。
目安としては一言で説明できてそれが非プログラマでも理解できるくらいの単位が理想。

## 作りを統一する

似たような処理、機能、画面などでまとめるべきでないと判断された場合はコードの作りを同じにする。

# テスト
機能が変更されていない(壊れていない)ことを保証するためにテストを書く必要がある。
別の章で解説。

# 参考

より詳細の情報は下記を参考にすること。

https://refactoring.com/catalog/
http://objectclub.jp/technicaldoc/refactoring/refact-smell

リファクタリング 既存のコードを安全に改善する
リファクタリング 2nd Edition も発売されているが英語
